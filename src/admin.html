<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <style>
      body {
        font-family: sans-serif;
        background-color: #f0f0f0;
        padding: 20px;
        margin: 0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      h1 {
        color: #d32f2f;
        text-align: center;
        margin-top: 0;
      }

      .warning {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 15px;
        border-radius: 4px;
        margin: 20px 0;
      }

      .info {
        margin-top: 20px;
        font-size: 0.9em;
        color: #666;
        text-align: center;
      }

      .section {
        margin-top: 30px;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }

      .section h2 {
        color: #495057;
        font-size: 1.2em;
        margin-top: 0;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #495057;
      }

      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 1em;
        box-sizing: border-box;
      }

      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1em;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      button:hover {
        background-color: #0056b3;
      }

      button.remove {
        background-color: #dc3545;
      }

      button.remove:hover {
        background-color: #c82333;
      }

      button.secondary {
        background-color: #6c757d;
      }

      button.secondary:hover {
        background-color: #5a6268;
      }

      .window-list {
        margin-top: 15px;
        max-height: 200px;
        overflow-y: auto;
        background-color: white;
        border: 1px solid #ced4da;
        border-radius: 4px;
        padding: 10px;
      }

      .window-item {
        padding: 8px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .window-item:last-child {
        border-bottom: none;
      }

      .status-message {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        text-align: center;
      }

      .status-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .recording-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
      }

      .option-group {
        margin-bottom: 15px;
      }

      .option-group label {
        display: inline;
        margin-left: 8px;
        font-weight: normal;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Admin Panel</h1>

      <div class="warning">
        <strong>Warning:</strong> This window is hidden from screenshots for privacy.
      </div>

      <p>This is a private admin panel with controls for recording and screenshot settings.</p>

      <div class="section">
        <h2>Recording & Screenshot Options</h2>
        <p>Configure how recordings and screenshots are captured.</p>

        <div class="recording-options">
          <div class="option-group">
            <input type="checkbox" id="record-audio" checked>
            <label for="record-audio">Record system audio</label>
          </div>

          <div class="option-group">
            <input type="checkbox" id="record-webcam" checked>
            <label for="record-webcam">Include webcam feed</label>
          </div>

          <div class="option-group">
            <input type="checkbox" id="hide-cursor" checked>
            <label for="hide-cursor">Hide cursor in recordings</label>
          </div>

          <div class="option-group">
            <input type="checkbox" id="auto-save" checked>
            <label for="auto-save">Auto-save recordings</label>
          </div>
        </div>

        <div class="form-group">
          <label for="screenshot-interval">Screenshot Interval (minutes):</label>
          <input type="number" id="screenshot-interval" min="1" max="60" value="15">
        </div>

        <div class="form-group">
          <label for="recording-quality">Recording Quality:</label>
          <select id="recording-quality">
            <option value="low">Low (faster, smaller files)</option>
            <option value="medium" selected>Medium (balanced)</option>
            <option value="high">High (better quality)</option>
            <option value="lossless">Lossless (largest files)</option>
          </select>
        </div>

        <button id="save-options-btn" class="secondary">Save Options</button>
        <button id="reset-options-btn">Reset to Defaults</button>
      </div>

      <div class="section">
        <h2>Window Exclusion Management</h2>
        <p>Add or remove window titles from the exclusion list to control which windows are hidden during recordings and screenshots.</p>

        <div class="form-group">
          <label for="window-title">Window Title to Exclude:</label>
          <input type="text" id="window-title" placeholder="e.g., Password, Settings, etc.">
        </div>

        <button id="add-window-btn">Add to Exclusion List</button>
        <button id="refresh-list-btn">Refresh List</button>

        <div id="status-message" class="status-message" style="display: none;"></div>

        <h3>Current Excluded Windows:</h3>
        <div id="excluded-windows-list" class="window-list">
          <!-- List will be populated dynamically -->
        </div>
      </div>

      <div class="section">
        <h2>System Status</h2>
        <p>Monitor the application status and performance.</p>

        <div class="recording-options">
          <div class="option-group">
            <label>Recording Status:</label>
            <div id="recording-status">Not Recording</div>
          </div>
          <div class="option-group">
            <label>Storage Used:</label>
            <div id="storage-used">0 MB</div>
          </div>
          <div class="option-group">
            <label>Active Sessions:</label>
            <div id="active-sessions">0</div>
          </div>
        </div>
      </div>

      <div class="info">
        <p>Press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>`</kbd> (backtick) to open this window again.</p>
      </div>
    </div>

    <script type="module">
      import { invoke } from '@tauri-apps/api/core';

      // DOM elements
      const windowTitleInput = document.getElementById('window-title');
      const addWindowBtn = document.getElementById('add-window-btn');
      const refreshListBtn = document.getElementById('refresh-list-btn');
      const excludedWindowsList = document.getElementById('excluded-windows-list');
      const statusMessage = document.getElementById('status-message');

      // Recording options elements
      const saveOptionsBtn = document.getElementById('save-options-btn');
      const resetOptionsBtn = document.getElementById('reset-options-btn');
      const screenshotInterval = document.getElementById('screenshot-interval');
      const recordingQuality = document.getElementById('recording-quality');
      const recordAudio = document.getElementById('record-audio');
      const recordWebcam = document.getElementById('record-webcam');
      const hideCursor = document.getElementById('hide-cursor');
      const autoSave = document.getElementById('auto-save');

      // Status elements
      const recordingStatus = document.getElementById('recording-status');
      const storageUsed = document.getElementById('storage-used');
      const activeSessions = document.getElementById('active-sessions');

      // Show status message
      function showStatus(message, isSuccess = true) {
        statusMessage.textContent = message;
        statusMessage.className = 'status-message ' + (isSuccess ? 'status-success' : 'status-error');
        statusMessage.style.display = 'block';

        // Auto-hide after 5 seconds
        setTimeout(() => {
          statusMessage.style.display = 'none';
        }, 5000);
      }

      // Populate the excluded windows list
      async function populateExcludedWindowsList() {
        try {
          const excludedWindows = await invoke('get_excluded_windows');
          excludedWindowsList.innerHTML = '';

          if (excludedWindows.length === 0) {
            excludedWindowsList.innerHTML = '<p style="text-align: center; color: #6c757d; margin: 0;">No windows currently excluded</p>';
            return;
          }

          excludedWindows.forEach(windowTitle => {
            const windowItem = document.createElement('div');
            windowItem.className = 'window-item';

            const titleSpan = document.createElement('span');
            titleSpan.textContent = windowTitle;

            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Remove';
            removeBtn.className = 'remove';
            removeBtn.onclick = async () => {
              try {
                const result = await invoke('remove_excluded_window', { windowTitle });
                showStatus(result);
                populateExcludedWindowsList(); // Refresh the list
              } catch (error) {
                showStatus(`Error removing window: ${error}`, false);
              }
            };

            windowItem.appendChild(titleSpan);
            windowItem.appendChild(removeBtn);
            excludedWindowsList.appendChild(windowItem);
          });
        } catch (error) {
          showStatus(`Error loading excluded windows: ${error}`, false);
        }
      }

      // Load recording options from storage (placeholder function)
      function loadOptions() {
        // In a real implementation, this would fetch from persistent storage
        // For now, using defaults
        const options = JSON.parse(localStorage.getItem('recordingOptions') || '{}');

        if (options.screenshotInterval) {
          screenshotInterval.value = options.screenshotInterval;
        }

        if (options.recordingQuality) {
          recordingQuality.value = options.recordingQuality;
        }

        recordAudio.checked = options.recordAudio !== undefined ? options.recordAudio : true;
        recordWebcam.checked = options.recordWebcam !== undefined ? options.recordWebcam : true;
        hideCursor.checked = options.hideCursor !== undefined ? options.hideCursor : true;
        autoSave.checked = options.autoSave !== undefined ? options.autoSave : true;
      }

      // Save recording options to storage
      function saveOptions() {
        const options = {
          screenshotInterval: parseInt(screenshotInterval.value),
          recordingQuality: recordingQuality.value,
          recordAudio: recordAudio.checked,
          recordWebcam: recordWebcam.checked,
          hideCursor: hideCursor.checked,
          autoSave: autoSave.checked
        };

        localStorage.setItem('recordingOptions', JSON.stringify(options));
        showStatus('Options saved successfully!');
      }

      // Reset options to defaults
      function resetOptions() {
        screenshotInterval.value = 15;
        recordingQuality.value = 'medium';
        recordAudio.checked = true;
        recordWebcam.checked = true;
        hideCursor.checked = true;
        autoSave.checked = true;

        localStorage.removeItem('recordingOptions');
        showStatus('Options reset to defaults!');
      }

      // Update status information (placeholder function)
      function updateStatus() {
        // In a real implementation, this would fetch actual status from the backend
        recordingStatus.textContent = Math.random() > 0.7 ? 'Recording' : 'Not Recording';
        storageUsed.textContent = Math.floor(Math.random() * 5000) + ' MB';
        activeSessions.textContent = Math.floor(Math.random() * 5) + ' active';
      }

      // Add event listeners
      addWindowBtn.addEventListener('click', async () => {
        const windowTitle = windowTitleInput.value.trim();

        if (!windowTitle) {
          showStatus('Please enter a window title to exclude', false);
          return;
        }

        try {
          const result = await invoke('add_excluded_window', { windowTitle });
          showStatus(result);
          windowTitleInput.value = ''; // Clear the input
          populateExcludedWindowsList(); // Refresh the list
        } catch (error) {
          showStatus(`Error adding window: ${error}`, false);
        }
      });

      refreshListBtn.addEventListener('click', populateExcludedWindowsList);

      saveOptionsBtn.addEventListener('click', saveOptions);
      resetOptionsBtn.addEventListener('click', resetOptions);

      // Initialize the page
      document.addEventListener('DOMContentLoaded', () => {
        loadOptions();
        populateExcludedWindowsList();
        updateStatus();

        // Update status periodically
        setInterval(updateStatus, 5000);
      });
    </script>
  </body>
</html>