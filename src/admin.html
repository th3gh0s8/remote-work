<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Remote Worker</title>
    <style>
      :root {
        --primary-color: #3b5bdb;
        --primary-dark: #2c4a96;
        --primary-light: #4a6fc9;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
        --light-bg: #2d2d2d;
        --dark-bg: #1e1e1e;
        --darker-bg: #1a1a1a;
        --border-color: #555;
        --text-primary: #e2e8f0;
        --text-secondary: #cbd5e0;
        --card-bg: #3d3d3d;
        --sidebar-width: 250px;
        --header-height: 60px;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: #1a1a1a;
        color: var(--text-primary);
        height: 100vh;
        overflow: hidden;
      }

      .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100%;
        max-width: 100%;
        background: var(--darker-bg);
        box-shadow: var(--box-shadow);
        border: 1px solid var(--border-color);
      }

      /* Header styling */
      .app-header {
        background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
        color: white;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: var(--header-height);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        z-index: 100;
      }

      .app-title {
        font-size: 1.2rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .app-title-icon {
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Main content area */
      .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* Sidebar navigation */
      .sidebar {
        width: var(--sidebar-width);
        background: var(--dark-bg);
        color: white;
        padding: 20px 0;
        overflow-y: auto;
        border-right: 1px solid var(--border-color);
        transition: var(--transition);
      }

      .nav-item {
        padding: 12px 20px;
        margin: 4px 10px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition);
        color: var(--text-primary);
      }

      .nav-item:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .nav-item.active {
        background: var(--primary-color);
        color: white;
      }

      .nav-item i {
        width: 20px;
        text-align: center;
      }

      /* Content area */
      .content-area {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: var(--dark-bg);
      }

      .section {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: var(--box-shadow);
        border: 1px solid var(--border-color);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .section-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-light);
        margin: 0;
      }

      .section-description {
        color: var(--text-secondary);
        margin-bottom: 15px;
        font-size: 0.9rem;
      }

      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 15px;
      }

      .form-group {
        flex: 1;
        min-width: 250px;
        margin-bottom: 0;
      }

      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
        color: var(--text-primary);
      }

      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 0.95rem;
        color: var(--text-primary);
        background-color: #333;
        transition: var(--transition);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 3px rgba(74, 111, 201, 0.3);
      }

      .option-group {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
      }

      .option-group input[type="checkbox"] {
        margin-right: 10px;
        width: 18px;
        height: 18px;
      }

      .option-group label {
        margin-bottom: 0;
        font-weight: normal;
        cursor: pointer;
      }

      /* Button styles */
      button {
        border: none;
        border-radius: var(--border-radius);
        padding: 10px 16px;
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      button.primary {
        background-color: var(--primary-color);
        color: white;
      }

      button.primary:hover {
        background-color: var(--primary-light);
      }

      button.secondary {
        background-color: var(--secondary-color);
        color: white;
      }

      button.secondary:hover {
        background-color: #5a6268;
      }

      button.success {
        background-color: var(--success-color);
        color: white;
      }

      button.success:hover {
        background-color: #218838;
      }

      button.danger {
        background-color: var(--danger-color);
        color: white;
      }

      button.danger:hover {
        background-color: #c82333;
      }

      button.outline {
        background-color: transparent;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
      }

      button.outline:hover {
        background-color: var(--primary-color);
        color: white;
      }

      /* Status and alerts */
      .status-card {
        background: #333;
        border-radius: var(--border-radius);
        padding: 15px;
        margin-top: 15px;
        border-left: 4px solid var(--primary-color);
      }

      .status-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .status-label {
        font-weight: 500;
        color: var(--text-secondary);
      }

      .status-value {
        font-weight: 600;
        color: var(--text-primary);
      }

      .warning {
        background-color: rgba(255, 193, 7, 0.15);
        border: 1px solid rgba(255, 193, 7, 0.4);
        color: #ffd700;
        padding: 12px;
        border-radius: var(--border-radius);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .status-message {
        margin-top: 15px;
        padding: 12px;
        border-radius: var(--border-radius);
        text-align: center;
        display: none;
      }

      .status-success {
        background-color: rgba(40, 167, 69, 0.15);
        color: #5cb85c;
        border: 1px solid rgba(40, 167, 69, 0.4);
      }

      .status-error {
        background-color: rgba(220, 53, 69, 0.15);
        color: #e74c3c;
        border: 1px solid rgba(220, 53, 69, 0.4);
      }

      /* Window list */
      .window-list {
        margin-top: 15px;
        max-height: 300px;
        overflow-y: auto;
        background-color: #333;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 5px;
      }

      .window-item {
        padding: 10px 15px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
      }

      .window-item:last-child {
        border-bottom: none;
      }

      .window-item:hover {
        background-color: #444;
      }

      .window-title {
        flex: 1;
        word-break: break-word;
        color: var(--text-primary);
      }

      .window-actions {
        display: flex;
        gap: 8px;
      }

      /* Footer */
      .app-footer {
        padding: 15px 20px;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.85rem;
        border-top: 1px solid var(--border-color);
        background: var(--dark-bg);
      }

      /* Responsive design */
      @media (max-width: 992px) {
        .sidebar {
          width: 70px;
          overflow: visible;
        }

        .nav-text {
          display: none;
        }

        .nav-item {
          justify-content: center;
          padding: 15px 0;
        }
      }

      @media (max-width: 768px) {
        .app-container {
          height: 100vh;
        }

        .main-content {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          height: auto;
          border-right: none;
          border-bottom: 1px solid var(--border-color);
          padding: 10px 0;
          background: var(--dark-bg);
        }

        .nav-container {
          display: flex;
          overflow-x: auto;
        }

        .nav-item {
          flex: 1;
          min-width: 100px;
          padding: 10px 5px;
          margin: 0 5px;
          flex-direction: column;
        }

        .content-area {
          padding: 15px;
          background: var(--dark-bg);
        }

        .form-group {
          min-width: 100%;
        }
      }

      @media (max-width: 576px) {
        .app-header {
          padding: 0 15px;
        }

        .section {
          padding: 15px;
        }

        .form-row {
          flex-direction: column;
          gap: 15px;
        }

        .status-card {
          padding: 10px;
        }

        .status-item {
          flex-direction: column;
          gap: 4px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="app-title">
          <div class="app-title-icon">‚öôÔ∏è</div>
          <span>Remote Worker Admin Panel</span>
        </div>
      </header>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
          <div class="nav-container">
            <div class="nav-item active" title="Configure recording settings">
              <i>üé•</i>
              <span class="nav-text">Recording</span>
            </div>
            <div class="nav-item" title="Manage window exclusions and privacy settings">
              <i>üîí</i>
              <span class="nav-text">Privacy</span>
            </div>
            <div class="nav-item" title="View system status and performance">
              <i>üìä</i>
              <span class="nav-text">Status</span>
            </div>
            <div class="nav-item" title="Application settings and preferences">
              <i>‚öôÔ∏è</i>
              <span class="nav-text">Settings</span>
            </div>
          </div>
        </aside>

        <!-- Content Area -->
        <main class="content-area">
          <div class="warning">
            <strong>‚ö†Ô∏è Privacy Notice:</strong> This window is hidden from screenshots and recordings for security.
          </div>

          <p>This is a private admin panel with controls for recording and screenshot settings.</p>

          <!-- Recording Options Section -->
          <div class="section" id="recording-section">
            <div class="section-header">
              <h2 class="section-title">Recording & Screenshot Options</h2>
            </div>
            <div class="status-card" style="margin-bottom: 15px;">
              <div class="status-item">
                <span class="status-label">Recording Status:</span>
                <span id="recording-status-indicator" class="status-value">Not Recording</span>
              </div>
              <div class="status-item">
                <span class="status-label">Recording State:</span>
                <span id="recording-state-indicator" class="status-value">Inactive</span>
              </div>
            </div>
            <p class="section-description">Configure how recordings and screenshots are captured.</p>

            <div class="form-row">
              <div class="form-group">
                <div class="option-group">
                  <input type="checkbox" id="record-audio" title="Enable system audio recording" checked>
                  <label for="record-audio">Record system audio</label>
                </div>

                <div class="option-group">
                  <input type="checkbox" id="record-webcam" title="Include webcam feed in recordings" checked>
                  <label for="record-webcam">Include webcam feed</label>
                </div>

                <div class="option-group">
                  <input type="checkbox" id="hide-cursor" title="Hide mouse cursor in recordings" checked>
                  <label for="hide-cursor">Hide cursor in recordings</label>
                </div>

                <div class="option-group">
                  <input type="checkbox" id="auto-save" title="Automatically save recordings when finished" checked>
                  <label for="auto-save">Auto-save recordings</label>
                </div>
              </div>

              <div class="form-group">
                <label for="screenshot-interval">Screenshot Interval (minutes):</label>
                <input type="number" id="screenshot-interval" min="1" max="60" value="15" title="Set the interval between screenshots in minutes">
              </div>

              <div class="form-group">
                <label for="recording-quality">Recording Quality:</label>
                <select id="recording-quality" title="Select the quality level for recordings">
                  <option value="low">Low (faster, smaller files)</option>
                  <option value="medium" selected>Medium (balanced)</option>
                  <option value="high">High (better quality)</option>
                  <option value="lossless">Lossless (largest files)</option>
                </select>
              </div>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
              <button id="start-recording-btn" class="primary" title="Start combined recording and screenshotting" style="display: none;">Start Recording</button>
              <button id="save-options-btn" class="primary" title="Save all current settings">Save Options</button>
              <button id="reset-options-btn" class="outline" title="Reset all settings to default values">Reset to Defaults</button>
              <button id="pause-recording-btn" class="outline" title="Pause the current recording">Pause Recording</button>
              <button id="resume-recording-btn" class="outline" title="Resume the paused recording">Resume Recording</button>
              <button id="stop-recording-btn" class="danger" title="Stop all processes (recording, screenshots, and idle detection)">Stop All Processes</button>
            </div>
          </div>

          <!-- Window Exclusion Management -->
          <div class="section" id="privacy-section">
            <div class="section-header">
              <h2 class="section-title">Window Exclusion Management</h2>
            </div>
            <p class="section-description">Add or remove window titles from the exclusion list to control which windows are hidden during recordings and screenshots.</p>

            <div class="form-row">
              <div class="form-group">
                <label for="window-title">Window Title to Exclude:</label>
                <input type="text" id="window-title" placeholder="e.g., Password, Settings, etc." title="Enter the window title to exclude from recordings">
              </div>

              <div class="form-group" style="display: flex; align-items: flex-end;">
                <button id="add-window-btn" class="success" title="Add the window title to the exclusion list">Add to Exclusion List</button>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <button id="refresh-list-btn" class="outline" title="Refresh the list of excluded windows">Refresh List</button>
            </div>

            <div id="status-message" class="status-message"></div>

            <h3 style="margin: 15px 0 10px;">Current Excluded Windows:</h3>
            <div id="excluded-windows-list" class="window-list">
              <!-- List will be populated dynamically -->
            </div>
          </div>

          <!-- System Status Section -->
          <div class="section" id="status-section">
            <div class="section-header">
              <h2 class="section-title">System Status</h2>
            </div>
            <p class="section-description">Monitor the application status and performance.</p>

            <div class="status-card">
              <div class="status-item">
                <span class="status-label">Recording Status:</span>
                <span id="recording-status" class="status-value">Not Recording</span>
              </div>
              <div class="status-item">
                <span class="status-label">Storage Used:</span>
                <span id="storage-used" class="status-value">0 MB</span>
              </div>
              <div class="status-item">
                <span class="status-label">Active Sessions:</span>
                <span id="active-sessions" class="status-value">0</span>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- Footer -->
      <footer class="app-footer">
        <p>Press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>`</kbd> (backtick) to open this window again.</p>
      </footer>
    </div>

    <script type="module">
      import { invoke } from '@tauri-apps/api/core';

      // DOM elements
      const windowTitleInput = document.getElementById('window-title');
      const addWindowBtn = document.getElementById('add-window-btn');
      const refreshListBtn = document.getElementById('refresh-list-btn');
      const excludedWindowsList = document.getElementById('excluded-windows-list');
      const statusMessage = document.getElementById('status-message');

      // Recording options elements
      const saveOptionsBtn = document.getElementById('save-options-btn');
      const resetOptionsBtn = document.getElementById('reset-options-btn');
      const screenshotInterval = document.getElementById('screenshot-interval');
      const recordingQuality = document.getElementById('recording-quality');
      const recordAudio = document.getElementById('record-audio');
      const recordWebcam = document.getElementById('record-webcam');
      const hideCursor = document.getElementById('hide-cursor');
      const autoSave = document.getElementById('auto-save');

      // Recording control buttons
      const startRecordingBtn = document.getElementById('start-recording-btn');
      const pauseRecordingBtn = document.getElementById('pause-recording-btn');
      const resumeRecordingBtn = document.getElementById('resume-recording-btn');
      const stopRecordingBtn = document.getElementById('stop-recording-btn');

      // Status elements
      const recordingStatus = document.getElementById('recording-status');
      const storageUsed = document.getElementById('storage-used');
      const activeSessions = document.getElementById('active-sessions');

      // Recording status indicators
      const recordingStatusIndicator = document.getElementById('recording-status-indicator');
      const recordingStateIndicator = document.getElementById('recording-state-indicator');

      // Show status message
      function showStatus(message, isSuccess = true) {
        statusMessage.textContent = message;
        statusMessage.className = 'status-message ' + (isSuccess ? 'status-success' : 'status-error');
        statusMessage.style.display = 'block';

        // Auto-hide after 5 seconds
        setTimeout(() => {
          statusMessage.style.display = 'none';
        }, 5000);
      }

      // Populate the excluded windows list
      async function populateExcludedWindowsList() {
        try {
          const excludedWindows = await invoke('get_excluded_windows');
          excludedWindowsList.innerHTML = '';

          if (excludedWindows.length === 0) {
            excludedWindowsList.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">No windows currently excluded</div>';
            return;
          }

          excludedWindows.forEach(windowTitle => {
            const windowItem = document.createElement('div');
            windowItem.className = 'window-item';

            const titleSpan = document.createElement('span');
            titleSpan.className = 'window-title';
            titleSpan.textContent = windowTitle;

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'window-actions';

            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Remove';
            removeBtn.className = 'danger';
            removeBtn.title = 'Remove this window from the exclusion list';
            removeBtn.onclick = async () => {
              try {
                const result = await invoke('remove_excluded_window', { windowTitle });
                showStatus(result);
                populateExcludedWindowsList(); // Refresh the list
              } catch (error) {
                showStatus(`Error removing window: ${error}`, false);
              }
            };

            actionsDiv.appendChild(removeBtn);
            windowItem.appendChild(titleSpan);
            windowItem.appendChild(actionsDiv);
            excludedWindowsList.appendChild(windowItem);
          });
        } catch (error) {
          showStatus(`Error loading excluded windows: ${error}`, false);
        }
      }

      // Load recording options from storage (placeholder function)
      function loadOptions() {
        // In a real implementation, this would fetch from persistent storage
        // For now, using defaults
        const options = JSON.parse(localStorage.getItem('recordingOptions') || '{}');

        if (options.screenshotInterval) {
          screenshotInterval.value = options.screenshotInterval;
        }

        if (options.recordingQuality) {
          recordingQuality.value = options.recordingQuality;
        }

        recordAudio.checked = options.recordAudio !== undefined ? options.recordAudio : true;
        recordWebcam.checked = options.recordWebcam !== undefined ? options.recordWebcam : true;
        hideCursor.checked = options.hideCursor !== undefined ? options.hideCursor : true;
        autoSave.checked = options.autoSave !== undefined ? options.autoSave : true;
      }

      // Save recording options to storage
      function saveOptions() {
        const options = {
          screenshotInterval: parseInt(screenshotInterval.value),
          recordingQuality: recordingQuality.value,
          recordAudio: recordAudio.checked,
          recordWebcam: recordWebcam.checked,
          hideCursor: hideCursor.checked,
          autoSave: autoSave.checked
        };

        localStorage.setItem('recordingOptions', JSON.stringify(options));
        showStatus('Options saved successfully!');
      }

      // Reset options to defaults
      function resetOptions() {
        screenshotInterval.value = 15;
        recordingQuality.value = 'medium';
        recordAudio.checked = true;
        recordWebcam.checked = true;
        hideCursor.checked = true;
        autoSave.checked = true;

        localStorage.removeItem('recordingOptions');
        showStatus('Options reset to defaults!');
      }

      // Function to check the actual recording status from the backend
      async function checkRecordingStatus() {
        try {
          // Get the actual process status from Rust
          const status = await invoke('get_process_status');

          // Parse the status string to determine recording state
          const isRecording = status.includes('Recording: Active');
          const isScreenshotting = status.includes('Screenshotting: Active');
          const isIdleDetection = status.includes('Idle Detection: Active');

          // Update the indicators based on actual status
          if (isRecording || isScreenshotting) {
            recordingStatusIndicator.textContent = 'Recording';
            recordingStateIndicator.textContent = 'Active';
            recordingStateIndicator.style.color = '#28a745'; // Green for active

            // Show proper buttons based on recording status
            if (startRecordingBtn) startRecordingBtn.style.display = 'none';
            if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'inline-flex';
            if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'none';
            if (stopRecordingBtn) stopRecordingBtn.style.display = 'inline-flex';
          } else {
            recordingStatusIndicator.textContent = 'Not Recording';
            recordingStateIndicator.textContent = 'Inactive';
            recordingStateIndicator.style.color = '#dc3545'; // Red for inactive

            // Show start button and hide others
            if (startRecordingBtn) startRecordingBtn.style.display = 'inline-flex';
            if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'none';
            if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'none';
            if (stopRecordingBtn) stopRecordingBtn.style.display = 'none';
          }

          // Update the recording status in the status section
          if (recordingStatus) {
            recordingStatus.textContent = isRecording ? 'Active' : 'Not Recording';
          }
        } catch (error) {
          console.error('Error checking recording status:', error);
        }
      }

      // Update status information
      function updateStatus() {
        // In a real implementation, this would fetch actual status from the backend
        recordingStatus.textContent = recordingStatusIndicator.textContent !== 'Inactive' ? 'Recording' : 'Not Recording';
        storageUsed.textContent = Math.floor(Math.random() * 5000) + ' MB';
        activeSessions.textContent = Math.floor(Math.random() * 5) + ' active';
      }

      // Add event listeners
      addWindowBtn.addEventListener('click', async () => {
        const windowTitle = windowTitleInput.value.trim();

        if (!windowTitle) {
          showStatus('Please enter a window title to exclude', false);
          return;
        }

        try {
          const result = await invoke('add_excluded_window', { windowTitle });
          showStatus(result);
          windowTitleInput.value = ''; // Clear the input
          populateExcludedWindowsList(); // Refresh the list
        } catch (error) {
          showStatus(`Error adding window: ${error}`, false);
        }
      });

      refreshListBtn.addEventListener('click', populateExcludedWindowsList);

      saveOptionsBtn.addEventListener('click', saveOptions);
      resetOptionsBtn.addEventListener('click', resetOptions);

      // Recording control button event listeners
      pauseRecordingBtn?.addEventListener('click', async () => {
        try {
          const result = await invoke('pause_combined_recording');
          showStatus(result);
          // Update button visibility
          pauseRecordingBtn.style.display = 'none';
          resumeRecordingBtn.style.display = 'inline-flex';
          // Update status indicators
          recordingStateIndicator.textContent = 'Paused';
          recordingStateIndicator.style.color = '#ffc107'; // Yellow for paused
        } catch (error) {
          showStatus(`Error pausing recording: ${error}`, false);
        }
      });

      resumeRecordingBtn?.addEventListener('click', async () => {
        try {
          const result = await invoke('resume_combined_recording');
          showStatus(result);
          // Update button visibility
          resumeRecordingBtn.style.display = 'none';
          pauseRecordingBtn.style.display = 'inline-flex';
          // Update status indicators
          recordingStateIndicator.textContent = 'Active';
          recordingStateIndicator.style.color = '#28a745'; // Green for active
        } catch (error) {
          showStatus(`Error resuming recording: ${error}`, false);
        }
      });

      startRecordingBtn?.addEventListener('click', async () => {
        try {
          const result = await invoke('start_combined_recording');
          showStatus(result);
          // Update button visibility
          startRecordingBtn.style.display = 'none';
          pauseRecordingBtn.style.display = 'inline-flex';
          resumeRecordingBtn.style.display = 'none';
          stopRecordingBtn.style.display = 'inline-flex';
          // Update status indicators
          recordingStatusIndicator.textContent = 'Recording';
          recordingStateIndicator.textContent = 'Active';
          recordingStateIndicator.style.color = '#28a745'; // Green for active
        } catch (error) {
          showStatus(`Error starting recording: ${error}`, false);
        }
      });

      stopRecordingBtn?.addEventListener('click', async () => {
        try {
          const result = await invoke('stop_all_processes');
          showStatus(result);
          // Update button visibility
          startRecordingBtn.style.display = 'inline-flex';
          pauseRecordingBtn.style.display = 'none';
          resumeRecordingBtn.style.display = 'none';
          stopRecordingBtn.style.display = 'none';
          // Update status indicators
          recordingStatusIndicator.textContent = 'Not Recording';
          recordingStateIndicator.textContent = 'Inactive';
          recordingStateIndicator.style.color = '#dc3545'; // Red for inactive
        } catch (error) {
          showStatus(`Error stopping all processes: ${error}`, false);
        }
      });

      // Navigation functionality
      const navItems = document.querySelectorAll('.nav-item');

      navItems.forEach((item, index) => {
        item.addEventListener('click', function() {
          // Remove active class from all nav items
          navItems.forEach(i => i.classList.remove('active'));
          // Add active class to clicked item
          this.classList.add('active');

          // Hide all sections
          document.querySelectorAll('.section').forEach(section => {
            section.style.display = 'none';
          });

          // Show the corresponding section based on nav item index
          if (index === 0) { // Recording
            document.getElementById('recording-section').style.display = 'block';
          } else if (index === 1) { // Privacy (Window Exclusion)
            document.getElementById('privacy-section').style.display = 'block';
          } else if (index === 2) { // Status
            document.getElementById('status-section').style.display = 'block';
          } else if (index === 3) { // Settings (Recording Options)
            document.getElementById('recording-section').style.display = 'block';
          }
        });
      });

      // Update status indicators when page loads
      recordingStatusIndicator.textContent = 'Not Recording';
      recordingStateIndicator.textContent = 'Inactive';
      recordingStateIndicator.style.color = '#dc3545'; // Red for inactive

      // Listen for recording events from Rust backend to keep UI synchronized across all windows
      window.addEventListener('DOMContentLoaded', async () => {
        // Import tauri event listener
        const { listen } = await import('@tauri-apps/api/event');

        // Listen for recording started event
        listen('recording-started', (event) => {
          recordingStatusIndicator.textContent = 'Recording';
          recordingStateIndicator.textContent = 'Active';
          recordingStateIndicator.style.color = '#28a745'; // Green for active

          // Show pause and stop buttons, hide resume and start buttons
          if (startRecordingBtn) startRecordingBtn.style.display = 'none';
          if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'inline-flex';
          if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'none';
          if (stopRecordingBtn) stopRecordingBtn.style.display = 'inline-flex';
        });

        // Listen for recording paused event
        listen('recording-paused', (event) => {
          recordingStateIndicator.textContent = 'Paused';
          recordingStateIndicator.style.color = '#ffc107'; // Yellow for paused

          // Show resume and stop buttons, hide pause and start buttons
          if (startRecordingBtn) startRecordingBtn.style.display = 'none';
          if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'none';
          if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'inline-flex';
          if (stopRecordingBtn) stopRecordingBtn.style.display = 'inline-flex';
        });

        // Listen for recording resumed event
        listen('recording-resumed', (event) => {
          recordingStateIndicator.textContent = 'Active';
          recordingStateIndicator.style.color = '#28a745'; // Green for active

          // Show pause and stop buttons, hide resume and start buttons
          if (startRecordingBtn) startRecordingBtn.style.display = 'none';
          if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'inline-flex';
          if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'none';
          if (stopRecordingBtn) stopRecordingBtn.style.display = 'inline-flex';
        });

        // Listen for recording finished event
        listen('recording-finished', (event) => {
          recordingStatusIndicator.textContent = 'Not Recording';
          recordingStateIndicator.textContent = 'Inactive';
          recordingStateIndicator.style.color = '#dc3545'; // Red for inactive

          // Show start button and hide other recording control buttons
          if (startRecordingBtn) startRecordingBtn.style.display = 'inline-flex';
          if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'none';
          if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'none';
          if (stopRecordingBtn) stopRecordingBtn.style.display = 'none';
        });

        // Listen for all processes stopped event
        listen('all-processes-stopped', (event) => {
          recordingStatusIndicator.textContent = 'Not Recording';
          recordingStateIndicator.textContent = 'Inactive';
          recordingStateIndicator.style.color = '#dc3545'; // Red for inactive

          // Show start button and hide other recording control buttons
          if (startRecordingBtn) startRecordingBtn.style.display = 'inline-flex';
          if (pauseRecordingBtn) pauseRecordingBtn.style.display = 'none';
          if (resumeRecordingBtn) resumeRecordingBtn.style.display = 'none';
          if (stopRecordingBtn) stopRecordingBtn.style.display = 'none';
        });

        // Initialize the page - show the first section by default
        loadOptions();
        populateExcludedWindowsList();
        updateStatus();

        // Check the actual process status from the backend
        checkRecordingStatus();

        // Initially hide all sections except the first one
        document.querySelectorAll('.section').forEach((section, index) => {
          if (index !== 0) {
            section.style.display = 'none';
          }
        });

        // Update status periodically
        setInterval(updateStatus, 5000);
        // Also check actual process status periodically
        setInterval(checkRecordingStatus, 2000);

        // Initially set status indicators
        recordingStatusIndicator.textContent = 'Not Recording';
        recordingStateIndicator.textContent = 'Inactive';
        recordingStateIndicator.style.color = '#dc3545'; // Red for inactive
      });
    </script>
  </body>
</html>